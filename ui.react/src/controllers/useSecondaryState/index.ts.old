import { useState, useCallback } from "react"
import {
  SecondaryPayload,
  SecondaryState,
  SecondaryInitialState,
  SecondaryPOST,
} from "../../containers/secondaryPage/types"
import { fetchSecondary } from "../../containers/App/api/SecondaryApi"

export const useSecondaryState = (dataCall: Function) => {
  const [state, setState] = useState<SecondaryState>(SecondaryInitialState)

  const handleSubmit = useCallback(
    (event: React.FormEvent<HTMLFormElement>, payload: SecondaryPOST) => {
      setState({ ...state, loading: true })
      event.preventDefault()
      dataCall(payload)
        .then((resp: SecondaryPayload) => {
          if (resp.success && resp.data) {
            setState({
              details: resp,
              error: false,
              errorMessage: null,
              loading: false,
            })
          } else {
            throw new Error(resp.error)
          }
        })
        .catch((err: any) => {
          setState({
            error: true,
            errorMessage: err,
            loading: false,
          })
        })
    },
    [dataCall, state],
  )

  return { state, handleSubmit }
}
